<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1694px" preserveAspectRatio="none" style="width:1011px;height:1694px;" version="1.1" viewBox="0 0 1011 1694" width="1011px" zoomAndPan="magnify"><defs/><g><rect fill="#7F7F7F" height="1031.0019" style="stroke: #7F7F7F; stroke-width: 1.0;" width="10" x="262" y="350.8003"/><line style="stroke: #7F7F7F; stroke-width: 1.0;" x1="262" x2="262" y1="350.8003" y2="1381.8022"/><line style="stroke: #7F7F7F; stroke-width: 1.0;" x1="272" x2="272" y1="350.8003" y2="1381.8022"/><line style="stroke: #7F7F7F; stroke-width: 1.0;" x1="262" x2="272" y1="350.8003" y2="350.8003"/><rect fill="#7F7F7F" height="28.7001" style="stroke: #7F7F7F; stroke-width: 1.0;" width="10" x="262" y="1409.8022"/><line style="stroke: #7F7F7F; stroke-width: 1.0;" x1="262" x2="262" y1="1409.8022" y2="1438.5023"/><line style="stroke: #7F7F7F; stroke-width: 1.0;" x1="272" x2="272" y1="1409.8022" y2="1438.5023"/><rect fill="#7F7F7F" height="27.7001" style="stroke: #7F7F7F; stroke-width: 1.0;" width="10" x="262" y="1466.5023"/><line style="stroke: #7F7F7F; stroke-width: 1.0;" x1="262" x2="262" y1="1466.5023" y2="1494.2024"/><line style="stroke: #7F7F7F; stroke-width: 1.0;" x1="272" x2="272" y1="1466.5023" y2="1494.2024"/><line style="stroke: #7F7F7F; stroke-width: 1.0;" x1="262" x2="272" y1="1494.2024" y2="1494.2024"/><rect fill="#7F7F7F" height="1031.0019" style="stroke: #7F7F7F; stroke-width: 1.0;" width="10" x="730" y="350.8003"/><line style="stroke: #7F7F7F; stroke-width: 1.0;" x1="730" x2="730" y1="350.8003" y2="1381.8022"/><line style="stroke: #7F7F7F; stroke-width: 1.0;" x1="740" x2="740" y1="350.8003" y2="1381.8022"/><line style="stroke: #7F7F7F; stroke-width: 1.0;" x1="730" x2="740" y1="350.8003" y2="350.8003"/><rect fill="#7F7F7F" height="28.7001" style="stroke: #7F7F7F; stroke-width: 1.0;" width="10" x="730" y="1409.8022"/><line style="stroke: #7F7F7F; stroke-width: 1.0;" x1="730" x2="730" y1="1409.8022" y2="1438.5023"/><line style="stroke: #7F7F7F; stroke-width: 1.0;" x1="740" x2="740" y1="1409.8022" y2="1438.5023"/><rect fill="#7F7F7F" height="27.7001" style="stroke: #7F7F7F; stroke-width: 1.0;" width="10" x="730" y="1466.5023"/><line style="stroke: #7F7F7F; stroke-width: 1.0;" x1="730" x2="730" y1="1466.5023" y2="1494.2024"/><line style="stroke: #7F7F7F; stroke-width: 1.0;" x1="740" x2="740" y1="1466.5023" y2="1494.2024"/><line style="stroke: #7F7F7F; stroke-width: 1.0;" x1="730" x2="740" y1="1494.2024" y2="1494.2024"/><rect fill="#FFFFFF" height="84.5501" style="stroke: #000000; stroke-width: 1.0;" width="783" x="109" y="94.85"/><rect fill="#FFFFFF" height="84.5501" style="stroke: #000000; stroke-width: 1.0;" width="804" x="99" y="238.5501"/><rect fill="#FFFFFF" height="880.3018" style="stroke: #000000; stroke-width: 1.0;" width="977" x="12" y="394.5004"/><rect fill="#FFFFFF" height="76.5501" style="stroke: #000000; stroke-width: 1.0;" width="544" x="229" y="420.6503"/><rect fill="#FFFFFF" height="346.151" style="stroke: #000000; stroke-width: 1.0;" width="902" x="50" y="511.2005"/><rect fill="#FFFFFF" height="396.4508" style="stroke: #000000; stroke-width: 1.0;" width="957" x="22" y="871.3514"/><rect fill="#FFFFFF" height="174.6504" style="stroke: #000000; stroke-width: 1.0;" width="895" x="74" y="897.5014"/><rect fill="#FFFFFF" height="174.6504" style="stroke: #000000; stroke-width: 1.0;" width="895" x="32" y="1086.1518"/><rect fill="#FFFFFF" height="132.5501" style="stroke: #000000; stroke-width: 1.0;" width="546" x="229" y="1333.9522"/><rect fill="#FFFFFF" height="84.5501" style="stroke: #000000; stroke-width: 1.0;" width="622" x="190" y="1554.3523"/><line style="stroke: #7F7F7F; stroke-width: 1.0;" x1="267" x2="267" y1="32.7001" y2="1381.8022"/><line style="stroke: #7F7F7F; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="267" x2="267" y1="1381.8022" y2="1409.8022"/><line style="stroke: #7F7F7F; stroke-width: 1.0;" x1="267" x2="267" y1="1409.8022" y2="1438.5023"/><line style="stroke: #7F7F7F; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="267" x2="267" y1="1438.5023" y2="1466.5023"/><line style="stroke: #7F7F7F; stroke-width: 1.0;" x1="267" x2="267" y1="1466.5023" y2="1655.9024"/><line style="stroke: #7F7F7F; stroke-width: 1.0;" x1="735" x2="735" y1="32.7001" y2="1381.8022"/><line style="stroke: #7F7F7F; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="735" x2="735" y1="1381.8022" y2="1409.8022"/><line style="stroke: #7F7F7F; stroke-width: 1.0;" x1="735" x2="735" y1="1409.8022" y2="1438.5023"/><line style="stroke: #7F7F7F; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="735" x2="735" y1="1438.5023" y2="1466.5023"/><line style="stroke: #7F7F7F; stroke-width: 1.0;" x1="735" x2="735" y1="1466.5023" y2="1655.9024"/><rect fill="#F8F8F8" height="28.7001" style="stroke: #383838; stroke-width: 1.5;" width="56" x="239" y="3"/><text fill="#000000" font-family="JetBrains Mono" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="42" x="246" y="21.8201">Client</text><rect fill="#F8F8F8" height="28.7001" style="stroke: #383838; stroke-width: 1.5;" width="56" x="239" y="1654.9024"/><text fill="#000000" font-family="JetBrains Mono" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="42" x="246" y="1673.7225">Client</text><rect fill="#F8F8F8" height="28.7001" style="stroke: #383838; stroke-width: 1.5;" width="56" x="707" y="3"/><text fill="#000000" font-family="JetBrains Mono" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="42" x="714" y="21.8201">Server</text><rect fill="#F8F8F8" height="28.7001" style="stroke: #383838; stroke-width: 1.5;" width="56" x="707" y="1654.9024"/><text fill="#000000" font-family="JetBrains Mono" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="42" x="714" y="1673.7225">Server</text><rect fill="#7F7F7F" height="1031.0019" style="stroke: #7F7F7F; stroke-width: 1.0;" width="10" x="262" y="350.8003"/><line style="stroke: #7F7F7F; stroke-width: 1.0;" x1="262" x2="262" y1="350.8003" y2="1381.8022"/><line style="stroke: #7F7F7F; stroke-width: 1.0;" x1="272" x2="272" y1="350.8003" y2="1381.8022"/><line style="stroke: #7F7F7F; stroke-width: 1.0;" x1="262" x2="272" y1="350.8003" y2="350.8003"/><rect fill="#7F7F7F" height="28.7001" style="stroke: #7F7F7F; stroke-width: 1.0;" width="10" x="262" y="1409.8022"/><line style="stroke: #7F7F7F; stroke-width: 1.0;" x1="262" x2="262" y1="1409.8022" y2="1438.5023"/><line style="stroke: #7F7F7F; stroke-width: 1.0;" x1="272" x2="272" y1="1409.8022" y2="1438.5023"/><rect fill="#7F7F7F" height="27.7001" style="stroke: #7F7F7F; stroke-width: 1.0;" width="10" x="262" y="1466.5023"/><line style="stroke: #7F7F7F; stroke-width: 1.0;" x1="262" x2="262" y1="1466.5023" y2="1494.2024"/><line style="stroke: #7F7F7F; stroke-width: 1.0;" x1="272" x2="272" y1="1466.5023" y2="1494.2024"/><line style="stroke: #7F7F7F; stroke-width: 1.0;" x1="262" x2="272" y1="1494.2024" y2="1494.2024"/><rect fill="#7F7F7F" height="1031.0019" style="stroke: #7F7F7F; stroke-width: 1.0;" width="10" x="730" y="350.8003"/><line style="stroke: #7F7F7F; stroke-width: 1.0;" x1="730" x2="730" y1="350.8003" y2="1381.8022"/><line style="stroke: #7F7F7F; stroke-width: 1.0;" x1="740" x2="740" y1="350.8003" y2="1381.8022"/><line style="stroke: #7F7F7F; stroke-width: 1.0;" x1="730" x2="740" y1="350.8003" y2="350.8003"/><rect fill="#7F7F7F" height="28.7001" style="stroke: #7F7F7F; stroke-width: 1.0;" width="10" x="730" y="1409.8022"/><line style="stroke: #7F7F7F; stroke-width: 1.0;" x1="730" x2="730" y1="1409.8022" y2="1438.5023"/><line style="stroke: #7F7F7F; stroke-width: 1.0;" x1="740" x2="740" y1="1409.8022" y2="1438.5023"/><rect fill="#7F7F7F" height="27.7001" style="stroke: #7F7F7F; stroke-width: 1.0;" width="10" x="730" y="1466.5023"/><line style="stroke: #7F7F7F; stroke-width: 1.0;" x1="730" x2="730" y1="1466.5023" y2="1494.2024"/><line style="stroke: #7F7F7F; stroke-width: 1.0;" x1="740" x2="740" y1="1466.5023" y2="1494.2024"/><line style="stroke: #7F7F7F; stroke-width: 1.0;" x1="730" x2="740" y1="1494.2024" y2="1494.2024"/><rect fill="#000000" height="3" style="stroke: #000000; stroke-width: 1.0;" width="996" x="3" y="64.2751"/><line style="stroke: #000000; stroke-width: 0.5;" x1="3" x2="999" y1="64.2751" y2="64.2751"/><line style="stroke: #000000; stroke-width: 0.5;" x1="3" x2="999" y1="67.2751" y2="67.2751"/><rect fill="#000000" height="25.1499" style="stroke: #000000; stroke-width: 1.0;" width="198" x="402" y="52.7001"/><text fill="#FFFFFF" font-family="JetBrains Mono" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="184" x="408" y="70.49">[ offline preparation ]</text><path d="M109,94.85 L858,94.85 L858,103.85 L848,113.85 L109,113.85 L109,94.85 " fill="#FFFFFF" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="84.5501" style="stroke: #000000; stroke-width: 1.0;" width="783" x="109" y="94.85"/><text fill="#000000" font-family="JetBrains Mono" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="704" x="124" y="109.64">Signature public/private keys, permanent or temporary (used for identity authentication)</text><rect fill="#FFFFFF" height="22" style="stroke: #000000; stroke-width: 1.0;" width="295" x="587" y="119"/><text fill="#000000" font-family="JetBrains Mono" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="287" x="591" y="134.82">S-Sig-Pub, S-Sig-Priv := Ed25519::keys ()</text><rect fill="#FFFFFF" height="22" style="stroke: #000000; stroke-width: 1.0;" width="295" x="119" y="151.7001"/><text fill="#000000" font-family="JetBrains Mono" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="287" x="123" y="167.5201">C-Sig-Pub, C-Sig-Priv := Ed25519::keys ()</text><rect fill="#000000" height="3" style="stroke: #000000; stroke-width: 1.0;" width="996" x="3" y="207.9751"/><line style="stroke: #000000; stroke-width: 0.5;" x1="3" x2="999" y1="207.9751" y2="207.9751"/><line style="stroke: #000000; stroke-width: 0.5;" x1="3" x2="999" y1="210.9751" y2="210.9751"/><rect fill="#000000" height="25.1499" style="stroke: #000000; stroke-width: 1.0;" width="214" x="394" y="196.4002"/><text fill="#FFFFFF" font-family="JetBrains Mono" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="200" x="400" y="214.1901">[ transport preparation ]</text><path d="M99,238.5501 L776,238.5501 L776,247.5501 L766,257.5501 L99,257.5501 L99,238.5501 " fill="#FFFFFF" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="84.5501" style="stroke: #000000; stroke-width: 1.0;" width="804" x="99" y="238.5501"/><text fill="#000000" font-family="JetBrains Mono" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="632" x="114" y="253.34">Session public/private keys, ephemeral (used for handshake and forward-secrecy)</text><rect fill="#FFFFFF" height="22" style="stroke: #000000; stroke-width: 1.0;" width="316" x="577" y="262.7"/><text fill="#000000" font-family="JetBrains Mono" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="308" x="581" y="278.5201">S-Ses-Pub, S-Ses-Priv := Curve25519::keys ()</text><rect fill="#FFFFFF" height="22" style="stroke: #000000; stroke-width: 1.0;" width="316" x="109" y="295.4001"/><text fill="#000000" font-family="JetBrains Mono" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="308" x="113" y="311.2202">C-Ses-Pub, C-Ses-Priv := Curve25519::keys ()</text><polygon fill="#383838" points="718,346.8003,728,350.8003,718,354.8003,722,350.8003" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="272" x2="724" y1="350.8003" y2="350.8003"/><text fill="#000000" font-family="JetBrains Mono" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="105" x="279" y="345.9203">[TCP handshake]</text><polygon fill="#383838" points="283,375.5004,273,379.5004,283,383.5004,279,379.5004" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="277" x2="729" y1="379.5004" y2="379.5004"/><text fill="#000000" font-family="JetBrains Mono" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="105" x="289" y="374.6204">[TCP handshake]</text><path d="M12,394.5004 L177,394.5004 L177,403.5004 L167,413.5004 L12,413.5004 L12,394.5004 " fill="#FFFFFF" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="880.3018" style="stroke: #000000; stroke-width: 1.0;" width="977" x="12" y="394.5004"/><text fill="#000000" font-family="JetBrains Mono" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="120" x="27" y="409.2904">Handshake phase</text><path d="M229,420.6503 L514,420.6503 L514,429.6503 L504,439.6503 L229,439.6503 L229,420.6503 " fill="#FFFFFF" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="76.5501" style="stroke: #000000; stroke-width: 1.0;" width="544" x="229" y="420.6503"/><text fill="#000000" font-family="JetBrains Mono" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="240" x="244" y="435.4403">Unencrypted exchanges over TCP</text><polygon fill="#383838" points="718,456.5004,728,460.5004,718,464.5004,722,460.5004" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="272" x2="724" y1="460.5004" y2="460.5004"/><text fill="#000000" font-family="JetBrains Mono" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="63" x="279" y="455.6204">C-Ses-Pub</text><polygon fill="#383838" points="283,485.2005,273,489.2005,283,493.2005,279,489.2005" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="277" x2="729" y1="489.2005" y2="489.2005"/><text fill="#000000" font-family="JetBrains Mono" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="63" x="289" y="484.3205">S-Ses-Pub</text><path d="M50,511.2005 L615,511.2005 L615,520.2005 L605,530.2005 L50,530.2005 L50,511.2005 " fill="#FFFFFF" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="346.151" style="stroke: #000000; stroke-width: 1.0;" width="902" x="50" y="511.2005"/><text fill="#000000" font-family="JetBrains Mono" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="520" x="65" y="525.9904">Symmetric keys, ephemeral (used for exchange and forward-secrecy)</text><rect fill="#FFFFFF" height="22" style="stroke: #000000; stroke-width: 1.0;" width="344" x="563" y="535.3504"/><text fill="#000000" font-family="JetBrains Mono" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="336" x="567" y="551.1705">Q := Curve25519::exchange (C-Ses-Pub, S-Ses-Pub)</text><rect fill="#FFFFFF" height="22" style="stroke: #000000; stroke-width: 1.0;" width="344" x="563" y="568.0505"/><text fill="#000000" font-family="JetBrains Mono" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="336" x="567" y="583.8706">S-X | C-X := Blake2B (Q | C-Ses-Pub | S-Ses-Pub)</text><rect fill="#FFFFFF" height="22" style="stroke: #000000; stroke-width: 1.0;" width="176" x="647" y="600.7506"/><text fill="#000000" font-family="JetBrains Mono" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="168" x="651" y="616.5707">destroy (Q, S-Sess-Priv)</text><rect fill="#FFFFFF" height="22" style="stroke: #000000; stroke-width: 1.0;" width="414" x="528" y="633.4507"/><text fill="#000000" font-family="JetBrains Mono" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="406" x="532" y="649.2708">S-N := 0x00..00 (64 bits) | S-Ses-Pub (truncate last bits)</text><rect fill="#FFFFFF" height="22" style="stroke: #000000; stroke-width: 1.0;" width="414" x="528" y="666.1508"/><text fill="#000000" font-family="JetBrains Mono" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="406" x="532" y="681.9709">C-N := 0x00..00 (64 bits) | C-Ses-Pub (truncate last bits)</text><rect fill="#FFFFFF" height="22" style="stroke: #000000; stroke-width: 1.0;" width="344" x="95" y="698.8509"/><text fill="#000000" font-family="JetBrains Mono" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="336" x="99" y="714.671">Q := Curve25519::exchange (C-Ses-Pub, S-Ses-Pub)</text><rect fill="#FFFFFF" height="22" style="stroke: #000000; stroke-width: 1.0;" width="344" x="95" y="731.551"/><text fill="#000000" font-family="JetBrains Mono" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="336" x="99" y="747.3711">S-X | C-X := Blake2B (Q | C-Ses-Pub | S-Ses-Pub)</text><rect fill="#FFFFFF" height="22" style="stroke: #000000; stroke-width: 1.0;" width="176" x="179" y="764.2511"/><text fill="#000000" font-family="JetBrains Mono" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="168" x="183" y="780.0712">destroy (Q, C-Sess-Priv)</text><rect fill="#FFFFFF" height="22" style="stroke: #000000; stroke-width: 1.0;" width="414" x="60" y="796.9512"/><text fill="#000000" font-family="JetBrains Mono" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="406" x="64" y="812.7713">S-N := 0x00..00 (64 bits) | S-Ses-Pub (truncate last bits)</text><rect fill="#FFFFFF" height="22" style="stroke: #000000; stroke-width: 1.0;" width="414" x="60" y="829.6513"/><text fill="#000000" font-family="JetBrains Mono" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="406" x="64" y="845.4714">C-N := 0x00..00 (64 bits) | C-Ses-Pub (truncate last bits)</text><path d="M22,871.3514 L467,871.3514 L467,880.3514 L457,890.3514 L22,890.3514 L22,871.3514 " fill="#FFFFFF" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="396.4508" style="stroke: #000000; stroke-width: 1.0;" width="957" x="22" y="871.3514"/><text fill="#000000" font-family="JetBrains Mono" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="400" x="37" y="886.1414">Encrypted exchanges over TCP (with ephemeral keys)</text><path d="M74,897.5014 L287,897.5014 L287,906.5014 L277,916.5014 L74,916.5014 L74,897.5014 " fill="#FFFFFF" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="174.6504" style="stroke: #000000; stroke-width: 1.0;" width="895" x="74" y="897.5014"/><text fill="#000000" font-family="JetBrains Mono" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="168" x="89" y="912.2913">Server authentication</text><rect fill="#FFFFFF" height="22" style="stroke: #000000; stroke-width: 1.0;" width="449" x="510" y="921.6513"/><text fill="#000000" font-family="JetBrains Mono" font-size="12" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="70" x="514" y="937.4714">S-Verifier</text><text fill="#000000" font-family="JetBrains Mono" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="161" x="591" y="937.4714">:= Ed25519::sign (msg =</text><text fill="#000000" font-family="JetBrains Mono" font-size="12" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="63" x="759" y="937.4714">C-Ses-Pub</text><text fill="#000000" font-family="JetBrains Mono" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="49" x="822" y="937.4714">, key =</text><text fill="#000000" font-family="JetBrains Mono" font-size="12" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="70" x="878" y="937.4714">S-Sig-Priv</text><text fill="#000000" font-family="JetBrains Mono" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="7" x="948" y="937.4714">)</text><polygon fill="#383838" points="283,966.0515,273,970.0515,283,974.0515,279,970.0515" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="277" x2="729" y1="970.0515" y2="970.0515"/><text fill="#000000" font-family="JetBrains Mono" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="168" x="289" y="965.1715">XSalsa20-Poly1305 (msg =</text><text fill="#000000" font-family="JetBrains Mono" font-size="12" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="63" x="464" y="965.1715">S-Sig-Pub</text><text fill="#000000" font-family="JetBrains Mono" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="49" x="527" y="965.1715">, key =</text><text fill="#000000" font-family="JetBrains Mono" font-size="12" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="21" x="583" y="965.1715">C-X</text><text fill="#000000" font-family="JetBrains Mono" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="63" x="604" y="965.1715">, nonce =</text><text fill="#000000" font-family="JetBrains Mono" font-size="12" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="35" x="674" y="965.1715">C-N++</text><text fill="#000000" font-family="JetBrains Mono" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="7" x="709" y="965.1715">)</text><polygon fill="#383838" points="283,994.7516,273,998.7516,283,1002.7516,279,998.7516" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="277" x2="729" y1="998.7516" y2="998.7516"/><text fill="#000000" font-family="JetBrains Mono" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="168" x="289" y="993.8716">XSalsa20-Poly1305 (msg =</text><text fill="#000000" font-family="JetBrains Mono" font-size="12" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="70" x="464" y="993.8716">S-Verifier</text><text fill="#000000" font-family="JetBrains Mono" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="49" x="534" y="993.8716">, key =</text><text fill="#000000" font-family="JetBrains Mono" font-size="12" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="21" x="590" y="993.8716">C-X</text><text fill="#000000" font-family="JetBrains Mono" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="63" x="611" y="993.8716">, nonce =</text><text fill="#000000" font-family="JetBrains Mono" font-size="12" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="35" x="681" y="993.8716">C-N++</text><text fill="#000000" font-family="JetBrains Mono" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="7" x="716" y="993.8716">)</text><rect fill="#FFFFFF" height="22" style="stroke: #000000; stroke-width: 1.0;" width="365" x="84" y="1011.7516"/><text fill="#000000" font-family="JetBrains Mono" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="154" x="88" y="1027.5717">Ed25519::verify (msg =</text><text fill="#000000" font-family="JetBrains Mono" font-size="12" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="70" x="249" y="1027.5717">S-Verifier</text><text fill="#000000" font-family="JetBrains Mono" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="49" x="319" y="1027.5717">, key =</text><text fill="#000000" font-family="JetBrains Mono" font-size="12" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="63" x="375" y="1027.5717">S-Sig-Pub</text><text fill="#000000" font-family="JetBrains Mono" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="7" x="438" y="1027.5717">)</text><rect fill="#FFFFFF" height="22" style="stroke: #000000; stroke-width: 1.0;" width="169" x="182" y="1044.4517"/><text fill="#000000" font-family="JetBrains Mono" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="161" x="186" y="1060.2718">is_trusted? (S-Sig-Pub)</text><path d="M32,1086.1518 L245,1086.1518 L245,1095.1518 L235,1105.1518 L32,1105.1518 L32,1086.1518 " fill="#FFFFFF" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="174.6504" style="stroke: #000000; stroke-width: 1.0;" width="895" x="32" y="1086.1518"/><text fill="#000000" font-family="JetBrains Mono" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="168" x="47" y="1100.9417">Client authentication</text><rect fill="#FFFFFF" height="22" style="stroke: #000000; stroke-width: 1.0;" width="449" x="42" y="1110.3017"/><text fill="#000000" font-family="JetBrains Mono" font-size="12" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="70" x="46" y="1126.1218">C-Verifier</text><text fill="#000000" font-family="JetBrains Mono" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="161" x="123" y="1126.1218">:= Ed25519::sign (msg =</text><text fill="#000000" font-family="JetBrains Mono" font-size="12" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="63" x="291" y="1126.1218">S-Ses-Pub</text><text fill="#000000" font-family="JetBrains Mono" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="49" x="354" y="1126.1218">, key =</text><text fill="#000000" font-family="JetBrains Mono" font-size="12" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="70" x="410" y="1126.1218">C-Sig-Priv</text><text fill="#000000" font-family="JetBrains Mono" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="7" x="480" y="1126.1218">)</text><polygon fill="#383838" points="718,1154.7019,728,1158.7019,718,1162.7019,722,1158.7019" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="272" x2="724" y1="1158.7019" y2="1158.7019"/><text fill="#000000" font-family="JetBrains Mono" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="168" x="279" y="1153.8219">XSalsa20-Poly1305 (msg =</text><text fill="#000000" font-family="JetBrains Mono" font-size="12" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="63" x="454" y="1153.8219">C-Sig-Pub</text><text fill="#000000" font-family="JetBrains Mono" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="49" x="517" y="1153.8219">, key =</text><text fill="#000000" font-family="JetBrains Mono" font-size="12" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="21" x="573" y="1153.8219">S-X</text><text fill="#000000" font-family="JetBrains Mono" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="63" x="594" y="1153.8219">, nonce =</text><text fill="#000000" font-family="JetBrains Mono" font-size="12" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="35" x="664" y="1153.8219">S-N++</text><text fill="#000000" font-family="JetBrains Mono" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="7" x="699" y="1153.8219">)</text><polygon fill="#383838" points="718,1183.402,728,1187.402,718,1191.402,722,1187.402" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="272" x2="724" y1="1187.402" y2="1187.402"/><text fill="#000000" font-family="JetBrains Mono" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="168" x="279" y="1182.522">XSalsa20-Poly1305 (msg =</text><text fill="#000000" font-family="JetBrains Mono" font-size="12" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="70" x="454" y="1182.522">C-Verifier</text><text fill="#000000" font-family="JetBrains Mono" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="49" x="524" y="1182.522">, key =</text><text fill="#000000" font-family="JetBrains Mono" font-size="12" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="21" x="580" y="1182.522">S-X</text><text fill="#000000" font-family="JetBrains Mono" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="63" x="601" y="1182.522">, nonce =</text><text fill="#000000" font-family="JetBrains Mono" font-size="12" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="35" x="671" y="1182.522">S-N++</text><text fill="#000000" font-family="JetBrains Mono" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="7" x="706" y="1182.522">)</text><rect fill="#FFFFFF" height="22" style="stroke: #000000; stroke-width: 1.0;" width="365" x="552" y="1200.402"/><text fill="#000000" font-family="JetBrains Mono" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="154" x="556" y="1216.2221">Ed25519::verify (msg =</text><text fill="#000000" font-family="JetBrains Mono" font-size="12" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="70" x="717" y="1216.2221">C-Verifier</text><text fill="#000000" font-family="JetBrains Mono" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="49" x="787" y="1216.2221">, key =</text><text fill="#000000" font-family="JetBrains Mono" font-size="12" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="63" x="843" y="1216.2221">C-Sig-Pub</text><text fill="#000000" font-family="JetBrains Mono" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="7" x="906" y="1216.2221">)</text><rect fill="#FFFFFF" height="22" style="stroke: #000000; stroke-width: 1.0;" width="169" x="650" y="1233.1021"/><text fill="#000000" font-family="JetBrains Mono" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="161" x="654" y="1248.9222">is_trusted? (C-Sig-Pub)</text><rect fill="#000000" height="3" style="stroke: #000000; stroke-width: 1.0;" width="996" x="3" y="1303.3772"/><line style="stroke: #000000; stroke-width: 0.5;" x1="3" x2="999" y1="1303.3772" y2="1303.3772"/><line style="stroke: #000000; stroke-width: 0.5;" x1="3" x2="999" y1="1306.3772" y2="1306.3772"/><rect fill="#000000" height="25.1499" style="stroke: #000000; stroke-width: 1.0;" width="166" x="418" y="1291.8022"/><text fill="#FFFFFF" font-family="JetBrains Mono" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="152" x="424" y="1309.5922">[ transport ready ]</text><path d="M229,1333.9522 L770,1333.9522 L770,1342.9522 L760,1352.9522 L229,1352.9522 L229,1333.9522 " fill="#FFFFFF" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="132.5501" style="stroke: #000000; stroke-width: 1.0;" width="546" x="229" y="1333.9522"/><text fill="#000000" font-family="JetBrains Mono" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="496" x="244" y="1348.7421">Exchange phase (always encrypted over TCP with ephemeral keys)</text><polygon fill="#383838" points="718,1369.8022,728,1373.8022,718,1377.8022,722,1373.8022" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="272" x2="724" y1="1373.8022" y2="1373.8022"/><text fill="#000000" font-family="JetBrains Mono" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="385" x="279" y="1368.9222">XSalsa20-Poly1305 (msg = ..., key = S-X, nonce = S-N++)</text><polygon fill="#383838" points="283,1426.5023,273,1430.5023,283,1434.5023,279,1430.5023" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="277" x2="729" y1="1430.5023" y2="1430.5023"/><text fill="#000000" font-family="JetBrains Mono" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="385" x="289" y="1425.6223">XSalsa20-Poly1305 (msg = ..., key = C-X, nonce = C-N++)</text><polygon fill="#383838" points="278,1490.2024,268,1494.2024,278,1498.2024,274,1494.2024" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="272" x2="734" y1="1494.2024" y2="1494.2024"/><text fill="#000000" font-family="JetBrains Mono" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="77" x="284" y="1489.3224">[TCP close]</text><rect fill="#000000" height="3" style="stroke: #000000; stroke-width: 1.0;" width="996" x="3" y="1523.7774"/><line style="stroke: #000000; stroke-width: 0.5;" x1="3" x2="999" y1="1523.7774" y2="1523.7774"/><line style="stroke: #000000; stroke-width: 0.5;" x1="3" x2="999" y1="1526.7774" y2="1526.7774"/><rect fill="#000000" height="25.1499" style="stroke: #000000; stroke-width: 1.0;" width="206" x="398" y="1512.2024"/><text fill="#FFFFFF" font-family="JetBrains Mono" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="192" x="404" y="1529.9923">[ transport terminated ]</text><path d="M190,1554.3523 L443,1554.3523 L443,1563.3523 L433,1573.3523 L190,1573.3523 L190,1554.3523 " fill="#FFFFFF" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="84.5501" style="stroke: #000000; stroke-width: 1.0;" width="622" x="190" y="1554.3523"/><text fill="#000000" font-family="JetBrains Mono" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="208" x="205" y="1569.1423">Ephemeral keys destruction</text><rect fill="#FFFFFF" height="22" style="stroke: #000000; stroke-width: 1.0;" width="134" x="668" y="1578.5022"/><text fill="#000000" font-family="JetBrains Mono" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="126" x="672" y="1594.3223">destroy (S-X, C-X)</text><rect fill="#FFFFFF" height="22" style="stroke: #000000; stroke-width: 1.0;" width="134" x="200" y="1611.2023"/><text fill="#000000" font-family="JetBrains Mono" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="126" x="204" y="1627.0224">destroy (S-X, C-X)</text><!--MD5=[ac0e400e062fbb4d2b1ff53bca0c2bee]
@startuml
	
	
	
	
	participant Client
	participant Server
	
	
	==[ offline preparation ]==
	
	
	group Signature public/private keys, permanent or temporary (used for identity authentication)
	rnote over Server : S-Sig-Pub, S-Sig-Priv := Ed25519::keys ()
	rnote over Client : C-Sig-Pub, C-Sig-Priv := Ed25519::keys ()
	end
	
	
	==[ transport preparation ]==
	
	
	group Session public/private keys, ephemeral (used for handshake and forward-secrecy)
	rnote over Server : S-Ses-Pub, S-Ses-Priv := Curve25519::keys ()
	rnote over Client : C-Ses-Pub, C-Ses-Priv := Curve25519::keys ()
	end
	
	
	Client - -> Server : [TCP handshake]
	activate Client
	activate Server
	Server - -> Client : [TCP handshake]
	
	
	group Handshake phase
	
	group Unencrypted exchanges over TCP
	Client -> Server : C-Ses-Pub
	Server -> Client : S-Ses-Pub
	end
	
	group Symmetric keys, ephemeral (used for exchange and forward-secrecy)
	rnote over Server : Q := Curve25519::exchange (C-Ses-Pub, S-Ses-Pub)
	rnote over Server : S-X | C-X := Blake2B (Q | C-Ses-Pub | S-Ses-Pub)
	rnote over Server : destroy (Q, S-Sess-Priv)
	rnote over Server : S-N := 0x00..00 (64 bits) | S-Ses-Pub (truncate last bits)
	rnote over Server : C-N := 0x00..00 (64 bits) | C-Ses-Pub (truncate last bits)
	rnote over Client : Q := Curve25519::exchange (C-Ses-Pub, S-Ses-Pub)
	rnote over Client : S-X | C-X := Blake2B (Q | C-Ses-Pub | S-Ses-Pub)
	rnote over Client : destroy (Q, C-Sess-Priv)
	rnote over Client : S-N := 0x00..00 (64 bits) | S-Ses-Pub (truncate last bits)
	rnote over Client : C-N := 0x00..00 (64 bits) | C-Ses-Pub (truncate last bits)
	end
	
	group Encrypted exchanges over TCP (with ephemeral keys)
	
	group Server authentication
	rnote over Server : **S-Verifier** := Ed25519::sign (msg = **C-Ses-Pub**, key = **S-Sig-Priv**)
	Server -> Client : XSalsa20-Poly1305 (msg = **S-Sig-Pub**, key = **C-X**, nonce = **C-N++**)
	Server -> Client : XSalsa20-Poly1305 (msg = **S-Verifier**, key = **C-X**, nonce = **C-N++**)
	rnote over Client : Ed25519::verify (msg = **S-Verifier**, key = **S-Sig-Pub**)
	rnote over Client : is_trusted? (S-Sig-Pub)
	end
	
	group Client authentication
	rnote over Client : **C-Verifier** := Ed25519::sign (msg = **S-Ses-Pub**, key = **C-Sig-Priv**)
	Client -> Server : XSalsa20-Poly1305 (msg = **C-Sig-Pub**, key = **S-X**, nonce = **S-N++**)
	Client -> Server : XSalsa20-Poly1305 (msg = **C-Verifier**, key = **S-X**, nonce = **S-N++**)
	rnote over Server : Ed25519::verify (msg = **C-Verifier**, key = **C-Sig-Pub**)
	rnote over Server : is_trusted? (C-Sig-Pub)
	end
	
	end
	
	end
	
	
	==[ transport ready ]==
	
	
	group Exchange phase (always encrypted over TCP with ephemeral keys)
	Client -> Server : XSalsa20-Poly1305 (msg = ..., key = S-X, nonce = S-N++)
	...
	Server -> Client : XSalsa20-Poly1305 (msg = ..., key = C-X, nonce = C-N++)
	...
	end
	
	Server - -> Client : [TCP close]
	deactivate Server
	deactivate Client
	
	
	==[ transport terminated ]==
	
	
	group Ephemeral keys destruction
	rnote over Server : destroy (S-X, C-X)
	rnote over Client : destroy (S-X, C-X)
	end
	
	
	
	
	skinparam Shadowing false
	skinparam Monochrome true
	skinparam BackgroundColor white
	skinparam DefaultFontName "JetBrains Mono"
	skinparam DefaultMonospacedFontName "JetBrains Mono"
	skinparam DefaultFontSize 12
	
	skinparam BoxPadding 32
	
	skinparam sequence {
		
		LifeLineBackgroundColor #808080
		LifeLineBorderColor #808080
		LifeLineBorderThickness 2
		
		GroupHeaderFontSize 14
		GroupBackgroundColor white
		GroupBodyBackgroundColor transparent
		GroupBorderThickness 1
		
		BoxBackgroundColor transparent
		
		DividerFontSize 14
		DividerFontColor white
		DividerBackgroundColor black
		DividerBorderColor black
		DividerBorderThickness 1
		
	}
	
	skinparam NoteFontSize 12
	skinparam NoteFontColor black
	skinparam NoteBackgroundColor white
	skinparam NoteBorderColor black
	skinparam NoteBorderThickness 1
	
	
	
	
@enduml

PlantUML version 1.2019.13(Tue Dec 10 19:18:29 EET 2019)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 13.0.2+8-suse-1.1-x8664
Operating System: Linux
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>